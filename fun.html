<!DOCTYPE html>
<html>
<head>
    <script src="ocanvas-2.4.0.js"></script>
    <style type="text/css">
        body {
            padding: 1em;
        }
    </style>
    <title>Fun</title>
</head>
<body>
<canvas id="canvas" width="800" height="500">

</canvas>
</body>
</html>
<script type="text/javascript">
    var canvas = oCanvas.create({ canvas: "#canvas", background: "#222" });

//    var lineProto = canvas.display.line({
//
//        stroke: "20px #0aa",
//        cap: "round"
//    });

    var branch = function(canvas, parent, x, y, length, angle) {
        var line = canvas.display.line({
            start: {x: x, y: y+length/2},
            end: {x: x, y: y-length/2},
            origin: {y:'bottom'},
            rotation: angle,
            stroke: "1px #0aa",
            cap: "round"
        });
        if(parent) {
            parent.addChild(line);
        }else {
            canvas.addChild(line);
        }
        return line;
    };
    var iterate = function(s, options) {
        var i;
        var j;
        var r0 = options.r0;
        var r1 = options.r1;
        var n = options.n;
        for (j=0; j < n; j++){
            for (i=0; i < s.length; i++) {
             var c = s[i];
                if (c == '1') {
                    s = s.slice(0, i) + r1 + s.slice(i+1);
                    i += r1.length-1;
                }
                else if (c == '0') {
                    s = s.slice(0, i) + r0 + s.slice(i+1);
                    i += r0.length-1;
                }
            }
        }
        return s;
    };

    var drawBranches = function(canvas, s, startIndex, x, y, options) {
        var i = 0;
        while(i+startIndex < s.length && s[i+startIndex] != ']') {
            var c = s[i+startIndex];
            if(c == '['){
                var recursiveOptions = {
                    'length': options.length * options.lengthDelta,
                    'angle': options.angle,
                    'lengthDelta': options.lengthDelta,
                    'angleDelta': options.angleDelta,
                    'parent' : options.parent
                };
                i += drawBranches(canvas, s, i+startIndex+1, x, y, recursiveOptions) + 1;
            }
            else if(c == '1') {
                var t = 0;
                while(s[t+i+startIndex]=='1') {t++} // count the 1s
                i += t - 1; // skip the ones we counted
                var length = options.length * t;
				var _x, _y;
                if (!options.parent) {
					_x = x;
					_y = y;
                } else {
				    _x = 0;
				    _y = (-1) * options.parent.length;
				}
                options.parent = branch(canvas, options.parent, _x, _y, length, options.angle);
            }
            else if (c == '+') {
                options.angle += options.angleDelta;
            }
            else if (c == '-') {
                options.angle -= options.angleDelta;
            }
            i++;
        }
        return i;
    };

    var s = "0";
    var iterateOptions = {
        r0 : "1[+0][-0]0",
        r1 : "11",
        n  : 6
    };

    var str = iterate(s, iterateOptions);

    var drawOptions = {
        'length': 6,
        'angle' : 0,
        'lengthDelta': 0.99,
        'angleDelta' : 38,
        'parent': null
    };
    drawBranches(canvas, str, 0, canvas.width/2, canvas.height, drawOptions);
</script>